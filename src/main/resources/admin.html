<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â≠¶‰ø°Ê°£Ê°àÁÆ°ÁêÜÂêéÂè∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 15px;
        }
        
        .btn-group {
            margin-bottom: 20px;
            text-align: right;
        }
        
        button {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button.delete {
            background: #f44336;
        }
        
        button.delete:hover {
            background: #da190b;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #4CAF50;
            color: white;
            font-weight: bold;
        }
        
        tr:hover {
            background: #f5f5f5;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close {
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: bold;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-actions {
            margin-top: 20px;
            text-align: right;
        }
        
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            display: none;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .actions {
            white-space: nowrap;
        }
        
        .actions button {
            margin: 0 5px;
            padding: 5px 10px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìö Â≠¶‰ø°Ê°£Ê°àÁÆ°ÁêÜÂêéÂè∞</h1>
        
        <div class="alert alert-success" id="successAlert"></div>
        <div class="alert alert-error" id="errorAlert"></div>
        
        <div class="btn-group">
            <button onclick="showAddModal()">‚ûï Ê∑ªÂä†Êñ∞ËÆ∞ÂΩï</button>
            <button onclick="loadRecords()">üîÑ Âà∑Êñ∞</button>
        </div>
        
        <table id="recordsTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>ÂßìÂêç</th>
                    <th>Èô¢Ê†°</th>
                    <th>‰∏ì‰∏ö</th>
                    <th>Â±ÇÊ¨°</th>
                    <th>Â≠¶‰π†ÂΩ¢Âºè</th>
                    <th>Êìç‰Ωú</th>
                </tr>
            </thead>
            <tbody id="recordsBody">
                <tr>
                    <td colspan="7" style="text-align:center; padding: 40px;">Âä†ËΩΩ‰∏≠...</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <!-- Ê∑ªÂä†/ÁºñËæëÊ®°ÊÄÅÊ°Ü -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Ê∑ªÂä†Â≠¶Á±çËÆ∞ÂΩï</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <form id="recordForm">
                <input type="hidden" id="recordId" name="id">
                
                <div class="form-group">
                    <label for="studentName">ÂßìÂêç *</label>
                    <input type="text" id="studentName" name="studentName" required>
                </div>
                
                <div class="form-group">
                    <label for="school">Èô¢Ê†°ÂêçÁß∞ *</label>
                    <input type="text" id="school" name="school" required>
                </div>
                
                <div class="form-group">
                    <label for="major">‰∏ì‰∏ö *</label>
                    <input type="text" id="major" name="major" required>
                </div>
                
                <div class="form-group">
                    <label for="level">Â±ÇÊ¨° *</label>
                    <select id="level" name="level" required>
                        <option value="">ËØ∑ÈÄâÊã©</option>
                        <option value="Êú¨Áßë">Êú¨Áßë</option>
                        <option value="‰∏ìÁßë">‰∏ìÁßë</option>
                        <option value="Á°ïÂ£´Á†îÁ©∂Áîü">Á°ïÂ£´Á†îÁ©∂Áîü</option>
                        <option value="ÂçöÂ£´Á†îÁ©∂Áîü">ÂçöÂ£´Á†îÁ©∂Áîü</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="studyForm">Â≠¶‰π†ÂΩ¢Âºè *</label>
                    <select id="studyForm" name="studyForm" required>
                        <option value="">ËØ∑ÈÄâÊã©</option>
                        <option value="ÊôÆÈÄöÂÖ®Êó•Âà∂">ÊôÆÈÄöÂÖ®Êó•Âà∂</option>
                        <option value="Êàê‰∫∫ËÑ±‰∫ß">Êàê‰∫∫ËÑ±‰∫ß</option>
                        <option value="Êàê‰∫∫‰∏ö‰Ωô">Êàê‰∫∫‰∏ö‰Ωô</option>
                        <option value="Êàê‰∫∫ÂáΩÊéà">Êàê‰∫∫ÂáΩÊéà</option>
                        <option value="ÁΩëÁªúÊïôËÇ≤">ÁΩëÁªúÊïôËÇ≤</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="description">ÊèèËø∞</label>
                    <input type="text" id="description" name="description" placeholder="‰æãÂ¶ÇÔºöÂú®Ê†°Áîü | ÂÖ•Â≠¶Êó∂Èó¥">
                </div>
                
                <div class="form-group">
                    <label for="admissionDate">ÂÖ•Â≠¶Êó•Êúü</label>
                    <input type="date" id="admissionDate" name="admissionDate">
                </div>
                
                <div class="form-group">
                    <label for="graduationDate">ÊØïÔºàÁªìÔºâ‰∏öÊó•Êúü</label>
                    <input type="date" id="graduationDate" name="graduationDate">
                </div>
                
                <div class="form-group">
                    <label for="studentId">Â≠¶Âè∑</label>
                    <input type="text" id="studentId" name="studentId">
                </div>
                
                <div class="form-group">
                    <label for="idCard">Ë∫´‰ªΩËØÅÂè∑</label>
                    <input type="text" id="idCard" name="idCard">
                </div>
                
                <div class="form-actions">
                    <button type="button" onclick="closeModal()">ÂèñÊ∂à</button>
                    <button type="submit">‰øùÂ≠ò</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Âä†ËΩΩËÆ∞ÂΩïÂàóË°®
        function loadRecords() {
            fetch('/admin/api/records')
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('recordsBody');
                    if (data.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding: 40px;">ÊöÇÊó†ËÆ∞ÂΩï</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = data.map(record => `
                        <tr>
                            <td>${escapeHtml(record.id)}</td>
                            <td>${escapeHtml(record.studentName)}</td>
                            <td>${escapeHtml(record.school)}</td>
                            <td>${escapeHtml(record.major)}</td>
                            <td>${escapeHtml(record.level)}</td>
                            <td>${escapeHtml(record.studyForm)}</td>
                            <td class="actions">
                                <button onclick="editRecord('${record.id}')">ÁºñËæë</button>
                                <button class="delete" onclick="deleteRecord('${record.id}')">Âà†Èô§</button>
                            </td>
                        </tr>
                    `).join('');
                })
                .catch(error => {
                    showError('Âä†ËΩΩÂ§±Ë¥•: ' + error.message);
                });
        }
        
        // ÊòæÁ§∫Ê∑ªÂä†Ê®°ÊÄÅÊ°Ü
        function showAddModal() {
            document.getElementById('modalTitle').textContent = 'Ê∑ªÂä†Â≠¶Á±çËÆ∞ÂΩï';
            document.getElementById('recordForm').reset();
            document.getElementById('recordId').value = '';
            document.getElementById('editModal').style.display = 'block';
        }
        
        // ÁºñËæëËÆ∞ÂΩï
        function editRecord(id) {
            fetch('/admin/api/records/' + id)
                .then(response => response.json())
                .then(record => {
                    document.getElementById('modalTitle').textContent = 'ÁºñËæëÂ≠¶Á±çËÆ∞ÂΩï';
                    document.getElementById('recordId').value = record.id;
                    document.getElementById('studentName').value = record.studentName || '';
                    document.getElementById('school').value = record.school || '';
                    document.getElementById('major').value = record.major || '';
                    document.getElementById('level').value = record.level || '';
                    document.getElementById('studyForm').value = record.studyForm || '';
                    document.getElementById('description').value = record.description || '';
                    document.getElementById('admissionDate').value = record.admissionDate || '';
                    document.getElementById('graduationDate').value = record.graduationDate || '';
                    document.getElementById('studentId').value = record.studentId || '';
                    document.getElementById('idCard').value = record.idCard || '';
                    document.getElementById('editModal').style.display = 'block';
                })
                .catch(error => {
                    showError('Âä†ËΩΩËÆ∞ÂΩïÂ§±Ë¥•: ' + error.message);
                });
        }
        
        // Âà†Èô§ËÆ∞ÂΩï
        function deleteRecord(id) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ËÆ∞ÂΩïÂêóÔºü')) {
                return;
            }
            
            fetch('/admin/api/records/' + id, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSuccess('Âà†Èô§ÊàêÂäü');
                    loadRecords();
                } else {
                    showError(data.message || 'Âà†Èô§Â§±Ë¥•');
                }
            })
            .catch(error => {
                showError('Âà†Èô§Â§±Ë¥•: ' + error.message);
            });
        }
        
        // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
        }
        
        // Ë°®ÂçïÊèê‰∫§
        document.getElementById('recordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const record = {};
            formData.forEach((value, key) => {
                if (value) record[key] = value;
            });
            
            const id = document.getElementById('recordId').value;
            const url = id ? '/admin/api/records/' + id : '/admin/api/records';
            const method = id ? 'PUT' : 'POST';
            
            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(record)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSuccess(id ? 'Êõ¥Êñ∞ÊàêÂäü' : 'Ê∑ªÂä†ÊàêÂäü');
                    closeModal();
                    loadRecords();
                } else {
                    showError(data.message || 'Êìç‰ΩúÂ§±Ë¥•');
                }
            })
            .catch(error => {
                showError('Êìç‰ΩúÂ§±Ë¥•: ' + error.message);
            });
        });
        
        // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
        function showSuccess(message) {
            const alert = document.getElementById('successAlert');
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        }
        
        // ÊòæÁ§∫ÈîôËØØÊ∂àÊÅØ
        function showError(message) {
            const alert = document.getElementById('errorAlert');
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }
        
        // HTMLËΩ¨‰πâ
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeModal();
            }
        }
        
        // È°µÈù¢Âä†ËΩΩÊó∂Ëé∑ÂèñËÆ∞ÂΩï
        loadRecords();
    </script>
</body>
</html>
